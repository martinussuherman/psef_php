<script>
  function fileUploadError(
    mode,
    fileInputElement,
    closeElement,
    viewElement,
    errorMessage) {
    if (mode == 'edit') {
      fileInputElement.prop('required', true);
    }

    fileInputElement.val('');
    closeElement.html('No file chosen');
    closeElement.attr("href", "#");
    viewElement.val('');

    swal({
      type: 'error',
      title: 'Maaf !',
      text: errorMessage,
    });
  }

  function uploadFile(mode, fileInputElement, closeElement, viewElement) {
    let data_upload = fileInputElement[0].files[0];
    let formData = new FormData();
    formData.append('file', data_upload);
    let val_upload = fileInputElement.val().toLowerCase();
    let regex = new RegExp("(.*?)\.(pdf)$");

    if (!regex.test(val_upload) && val_upload != '') {
      fileUploadError(
        mode,
        fileInputElement,
        closeElement,
        viewElement,
        'Pastikan berkas yang anda upload berupa PDF');
      return;
    }

    if (data_upload.size <= 0 || data_upload.size > 5300000) {
      fileUploadError(
        mode,
        fileInputElement,
        closeElement,
        viewElement,
        'Pastikan berkas yang anda upload maksimal 1MB');
      return;
    }

    $.ajax({
      url: url_api_x + 'UploadUserFile',
      type: 'POST',
      beforeSend: function (xhr) {
        xhr.setRequestHeader('Authorization', 'Bearer ' + accesstoken + '');
      },
      data: formData,
      processData: false,
      contentType: false,
      success: function (data, textStatus, xhr) {
        viewElement.val(data.value);

        if (data == 'edit') {
          let split_dokumen = data.value.split("/");
          let name_dokumen = split_dokumen[split_dokumen.length - 1];
          closeElement.html(name_dokumen);
          closeElement.attr("href", "https://psef.kemkes.go.id" + data.value);
          fileInputElement.prop('required', true);
        }
      },
      error: function (xhr, textStatus, errorThrown) {
        fileUploadError(
          mode,
          fileInputElement,
          closeElement,
          viewElement,
          'Pastikan Berkas yang anda upload sesuai dengan ketentuan!');
      }
    });
  }

  function upload_stra(mode) {
    uploadFile(
      mode,
      $("#straUrl"),
      $('#close-straUrl'),
      $('#v-straUrl'));
  }

  function upload_dokapi(mode) {
    uploadFile(
      mode,
      $('#dokumenApiUrl'),
      $('#close-dokumenApiUrl'),
      $('#v-dokumenApiUrl'));
  }

  function upload_bisnis(mode) {
    uploadFile(
      mode,
      $('#prosesBisnisUrl'),
      $('#close-prosesBisnisUrl'),
      $('#v-prosesBisnisUrl'));
  }

  function upload_dok_pse(mode) {
    uploadFile(
      mode,
      $('#dokumenPseUrl'),
      $('#close-dokumenPseUrl'),
      $('#v-dokumenPseUrl'));
  }

  function upload_permohonan(mode) {
    uploadFile(
      mode,
      $('#suratPermohonanUrl'),
      $('#close-suratPermohonanUrl'),
      $('#v-suratPermohonanUrl'));
  }
  function upload_dok_izin_usaha(mode) {
    uploadFile(
      mode,
      $('#izinUsahaUrl'),
      $('#close-izinUsahaUrl'),
      $('#v-izinUsahaUrl'));
  }
  function upload_dok_kka(mode) {
    uploadFile(
      mode,
      $('#komitmenKerjasamaApotekUrl'),
      $('#close-komitmenKerjasamaApotekUrl'),
      $('#v-komitmenKerjasamaApotekUrl'));
  }

  function upload_sppl(mode) {
    uploadFile(
      mode,
      $('#spplUrl'),
      $('#close-spplUrl'),
      $('#v-spplUrl'));
  }

  function upload_izin_lokasi(mode) {
    uploadFile(
      mode,
      $('#izinLokasiUrl'),
      $('#close-izinLokasiUrl'),
      $('#v-izinLokasiUrl'));
  }

  function upload_imb(mode) {
    uploadFile(
      mode,
      $('#imbUrl'),
      $('#close-imbUrl'),
      $('#v-imbUrl'));
  }

  function upload_pnbp(mode) {
    uploadFile(
      mode,
      $('#pembayaranPnbpUrl'),
      $('#close-pembayaranPnbpUrl'),
      $('#v-pembayaranPnbpUrl'));
  }

</script>
